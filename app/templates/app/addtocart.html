{% extends "app/base.html" %}
{% load static %}
{% block title %}Cart{% endblock title %}

{% block main-content %}
{% csrf_token %}
<div class="container my-5">
    <div class="row">
        {% if cart %}
        <h1 class="text-center mb-5">Shopping Cart</h1>
        <div class="col-sm-8">
            <div class="cart">
                <div class="cart-body">
                    <h3>Cart</h3>
                    {% for item in cart %}
                    <div class="row">
                        <div class="col-sm-3 text-center align-self-center"><img
                                src="{{item.product.product_image.url}}" alt="" srcset=""
                                class="img-fluid img-thumbnail shadow-sm" height="150" width="150"></div>
                        <div class="col-sm-9">
                            <div>
                                <h5>{{item.product.title}}</h5>
                                <p class="mb-2 text-muted small">{{item.product.description}}</p>
                                <div class="my-3">
                                    <label for="quantity">Quantity:</label>
                                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
                                    <a class="minus-cart btn" pid="{{item.product.id}}"><i
                                            class="fas fa-minus-square fa-lg"></i></a>
                                    <span id="quantity">{{item.quantity}}</span>
                                    <a class="plus-cart btn" pid="{{item.product.id}}"><i
                                            class="fas fa-plus-square fa-lg"></i></a>
                                </div>
                                <!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> -->
                                <div class="d-flex justify-content-between">
                                    <a href="#" class="remove-cart btn btn-secondary mr-3 remove-item-btn"
                                        pid="{{item.product.id}}">Remove item</a>
                                    <p class="mb-0"><span><strong>Rs. {{item.product.discounted_price}}</strong></span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr class="text-muted">
                    {% endfor %}

                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    // Function to remove an item from the cart
    $(document).on('click', '.remove-item-btn', function() {
        var product_id = $(this).attr('pid');
        var row = $(this).closest('.row'); // Save the row element to be removed

        $.ajax({
            url: '{% url "remove-cart" %}',
            type: 'POST',
            data: {
                'product_id': product_id,
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            },
            success: function(response) {
                if (response.success) {
                    // Remove the deleted item from the cart visually
                    row.remove();
                    // Update the displayed amounts
                    $('#amount').text('Rs. ' + response.amount);
                    $('#totalamount').text('Rs. ' + response.totalamount);
                }
            }
        });
    });
</script>


<div class="col-sm-4">
    <div class="cart">
        <div class="cart-body">
            <h3>The Total Amount Of</h3>
            <ul class="list-group">
                <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-0">
                    Amount<span id="amount">Rs. {{amount}}</span></li>
                <li class="list-group-item d-flex justify-content-between align-items-center px-0">Shipping<span>Rs.
                        40.00</span></li>
                <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 nb-3">
                    <div>
                        <strong>Total</strong><small>{including gst}</small>
                    </div>
                    <span id="totalamount"><strong>Rs. {{totalamount}}</strong></span>
                </li>
            </ul>
            <div class="d-grid"><a href="{% url 'checkout' %}" class="btn btn-primary">Place Order</a></div>
        </div>
    </div>
</div>
{% else %}
<h1 class="text-center mb-5">Cart Is Empty</h1>
{% endif %}


{% endblock main-content %}